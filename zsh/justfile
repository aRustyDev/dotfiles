import '../.build/just/lib.just'

zsh := root + "/zsh"
docker := root + "/.build/zsh.Dockerfile"
dotdir := xdg_config + "/zsh"

test:
    echo "Testing ZSH"
    docker run --rm -it --device /dev/kvm -v /tmp/.X11-unix:/tmp/.X11-unix zshrc:latest
    echo "Testing Complete"

install: zshenv zshrc zprofile zlogin zplugins zinit zcomp zfuncs dot_helper
    @echo " ::: source {{dotdir}}/.zshenv"
    @echo " ::: source {{dotdir}}/.zshrc"

zplugins: mktree
    @cp -r "{{ justfile_directory() }}/plugins" "{{ dotdir }}"

zinit: mktree
    @cp -r "{{ justfile_directory() }}/init" "{{ dotdir }}"

zfuncs: mktree
    @cp -r "{{ justfile_directory() }}/functions" "{{ dotdir }}"

zcomp: mktree
    @cp -r "{{ justfile_directory() }}/completions" "{{ dotdir }}"

dot_helper: mktree
    @cp -r "{{root}}/dot_helper/" "{{xdg_config}}"

zlogin: mktree
    @cp "{{ justfile_directory() }}/.zlogin" "{{dotdir}}/.zlogin"
    @echo "Copied .zlogin -> {{dotdir}}/.zlogin"

zprofile: mktree
    @cp "{{ justfile_directory() }}/.zprofile" "{{dotdir}}/.zprofile"
    @echo "Copied .zprofile -> {{dotdir}}/.zprofile"

zshrc: mktree
    @cp "{{ justfile_directory() }}/.zshrc" "{{dotdir}}/.zshrc"
    @echo "Copied .zshrc -> {{dotdir}}/.zshrc"

zshenv: mktree
    @cp "{{ justfile_directory() }}/.zshenv" "{{dotdir}}/.zshenv"
    @echo "Copied .zshenv -> {{dotdir}}/.zshenv"
    @sudo cp "{{ justfile_directory() }}/etc/.zshenv" /etc/zshenv
    @echo "Copied ./etc/.zshenv -> /etc/zshenv"

mktree:
    @mkdir -p {{ dotdir }}/{completions,init,plugins,functions}
