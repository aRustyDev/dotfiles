server:
	# log verbosity
    verbosity: 1
    log-queries: no
    log-replies: no

    # Set it to "127.0.0.1" to listen on requests from the same machine only
    interface: {{localhost}}
    # Control IP ranges which should be able to use this Unbound instance.
    access-control: 127.0.0.1/8 allow

    # access rules
    chroot: ""
    username: "{{user}}"

    # enable DNSSEC
    auto-trust-anchor-file: "/usr/local/etc/unbound/root.key"

    # answer DNS queries on this port
    port: 53

    # A single thread is pretty sufficient for home or small office instances.
    num-threads: 1

    # enable IPV4/IPV6, UDP/TCP
    do-ip4: yes
    do-ip6: no
    do-udp: yes
    do-tcp: yes

    # which client IPs are allowed to make (recursive) queries to this server
    access-control: 10.0.0.0/8 allow
    access-control: 127.0.0.0/8 allow
    access-control: 192.168.0.0/16 allow

    # Hardening
    harden-glue: yes
    harden-dnssec-stripped: yes
    harden-algo-downgrade: yes
    harden-large-queries: yes
    harden-short-bufsize: yes

    # Privacy
    use-caps-for-id: yes # Spoof protection by randomising capitalisation
    rrset-roundrobin: yes
    qname-minimisation: yes
    minimal-responses: yes
    hide-identity: yes
    identity: "Server" # Purposefully a dummy identity name
    hide-version: yes

    # Caching
    cache-min-ttl: 60
    cache-max-ttl: 3600
    serve-expired: yes
    neg-cache-size: 4M
    prefetch: yes
    prefetch-key: yes
    msg-cache-size: 128m
    rrset-cache-size: 256m
    so-rcvbuf: 4m
    so-sndbuf: 4m
    msg-cache-slabs: 8
    rrset-cache-slabs: 8
    infra-cache-slabs: 8
    key-cache-slabs: 8
    aggressive-nsec: yes

    # Private IP ranges, which shall never be returned or forwarded as public DNS response.
    private-address: 192.168.0.0/16
    private-address: 172.16.0.0/12
    private-address: 10.0.0.0/8
    private-address: 169.254.0.0/16
    private-address: fd00::/8
    private-address: fe80::/10
    private-domain: "home.lan"
    unwanted-reply-threshold: 10000
    val-clean-additional: yes

remote-control:
	control-enable: yes
	control-interface: {{localhost}}
	server-key-file: "/usr/local/etc/unbound/unbound_server.key"
	server-cert-file: "/usr/local/etc/unbound/unbound_server.pem"
	control-key-file: "/usr/local/etc/unbound/unbound_control.key"
	control-cert-file: "/usr/local/etc/unbound/unbound_control.pem"

# enable DNS over TLS
forward-zone:
	name:"." # use Quad9
	forward-addr:9.9.9.9@853
	forward-ssl-upstream:yes

{{#zones}}
local-zone: "{{name}}" static
{{#ips}}
local-data: "{{name}} A {{.}}"
local-data: "{{name}} A {{.}}"
{{/ips}}

{{/zones}}
