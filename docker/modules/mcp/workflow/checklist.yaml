# =============================================================================
# SimpleCheckList MCP Server - HTTP Native
# =============================================================================
# Task and checklist management with persistent storage and web UI.
#
# Image: mayurkakade/mcp-server:latest (HTTP-native, no wrapper needed)
#
# Usage in MCP clients (e.g., Zed):
#   {
#     "checklist": {
#       "url": "https://tool.localhost/api",
#       "headers": {
#         "X-Service": "checklist"
#       }
#     }
#   }
#
# Web UI: https://tool.localhost/ui with header X-Service: checklist
#
# Tools provided:
#   - create_checklist: Create a new checklist
#   - get_checklists: List all checklists
#   - add_item: Add item to a checklist
#   - toggle_item: Mark item complete/incomplete
#   - delete_item: Remove item from checklist
#   - delete_checklist: Delete entire checklist
#
# Endpoints:
#   - API: port 8355 (/api)
#   - UI: port 80 (/ui)
#
# Source: https://github.com/DevMayur/SimpleCheckList
# =============================================================================
services:
  checklists:
    image: mayurkakade/mcp-server:latest
    container_name: checklists
    profiles: ["mcp-workflow", "mcp"]
    stdin_open: true # docker run -i
    tty: true # docker run -t
    restart: unless-stopped
    networks:
      - backend        # MCP backend services network
    expose:
      - "8355"
      - "80"
    extra_hosts:
      host.docker.internal: host-gateway
    volumes:
      - "${XDG_DATA_HOME:?err_xdg_data_home}/mcp/checklist:/app/data"
    environment:
      API_BASE_URL: http://host.docker.internal:8355/api
      DATABASE_PATH: /data/checklist.db
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          cpus: "0.1"
          memory: 128M
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8355/api/health || exit 1"]
      interval: 15s
      timeout: 10s
      retries: 3
      start_period: 30s
    labels:
      # =======================================================================
      # Traefik Configuration
      # =======================================================================
      # NOTE: Routing is defined in file provider (svc.mcp.checklist.yaml)
      # because parentRefs (multi-layer routing) is not supported in Docker labels.
      # =======================================================================
      traefik.enable: true
      traefik.docker.network: backend
      # Observability labels
      o11y.service: "mcp-checklist"
      o11y.component: "mcp"
    logging:
      driver: "${O11Y_LOGGING_DRIVER:-json-file}"
      options:
        max-size: "${O11Y_LOG_MAX_SIZE:-10m}"
        max-file: "${O11Y_LOG_MAX_FILES:-3}"
        tag: '{{ "{{.Name}}" }}'

