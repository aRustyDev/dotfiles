# =============================================================================
# Context7 MCP Server - Streamable HTTP
# =============================================================================
# Provides up-to-date, version-specific documentation for LLMs and AI editors.
#
# Image: mcp/context7 (Docker MCP Catalog - wraps @upstash/context7-mcp)
#
# Usage in MCP clients (e.g., Zed):
#   {
#     "context7": {
#       "url": "https://doc.localhost/mcp",
#       "headers": {
#         "X-Service": "context7"
#       }
#     }
#   }
#
# Tools provided:
#   - resolve-library-id: Get Context7-compatible library ID
#   - get-library-docs: Fetch documentation for a library
#
# Source: https://github.com/upstash/context7
# Docker Hub: https://hub.docker.com/r/mcp/context7
# =============================================================================
---
services:
  context7:
    image: mcp/context7:latest
    container_name: context7
    profiles: ["mcp-docs", "mcp"]
    restart: unless-stopped
    networks:
      - backend        # MCP backend services network
    expose:
      - "8080"
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/mcp"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    # Resource Tier 2: Light (documentation indexing)
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          cpus: "0.1"
          memory: 128M
    environment:
      # Transport mode: http (default), stdio
      MCP_TRANSPORT: http
      # Server port (default: 8080)
      PORT: 8080
      # API key for higher rate limits (60 req/hr without key)
      CONTEXT7_API_KEY: "op://Developer/context7/credential"
    labels:
      # =======================================================================
      # Traefik Configuration - Streamable HTTP MCP
      # =======================================================================
      # NOTE: Routing is defined in file provider (svc.mcp.context7.yaml)
      # because parentRefs (multi-layer routing) is not supported in Docker labels.
      # See: https://doc.traefik.io/traefik/reference/routing-configuration/http/routing/multi-layer-routing/
      # =======================================================================
      traefik.enable: true
      traefik.docker.network: backend

