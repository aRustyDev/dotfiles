services:
  falkordb:
    image: falkordb/falkordb:latest
    container_name: graphdb
    stdin_open: true # docker run -i
    tty: true # docker run -t
    expose:
      - "6379" # Redis/FalkorDB port
      - "3000" # FalkorDB web UI
    environment:
      - FALKORDB_PASSWORD=${FALKORDB_PASSWORD:-}
      - BROWSER=${BROWSER:-1} # Enable FalkorDB Browser UI (set to 0 to disable)
    volumes:
      - ${XDG_DATA_HOME:-${XDG_DATA_HOME:?err_xdg_data_home}}/mcp/memory:/data # Persist FalkorDB data
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 2G
        reservations:
          cpus: "0.25"
          memory: 512M
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6379", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    networks:
      - traefik-public
    labels:
      # =======================================================================
      # Traefik Configuration - FalkorDB Graph Database
      # =======================================================================
      # NOTE: Routing is defined in file provider (svc.db.falkordb.yaml)
      # because parentRefs (multi-layer routing) is not supported in Docker labels.
      #
      # Endpoints:
      #   - Database (Redis protocol): port 6379 (via db@file -> falkordb)
      #   - Web UI: port 3000 (via ui@file -> falkorui)
      # =======================================================================
      traefik.enable: true
      traefik.docker.network: traefik-public
