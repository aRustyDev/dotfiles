services:
  # 1. Workflows MCP - YAML-based orchestration
  workflows-mcp:
    image: node:20-alpine
    container_name: workflows
    restart: unless-stopped
    working_dir: /app
    command:
      - sh
      - -c
      - |
        npm install -g workflows-mcp-server &&
        exec workflows-mcp-server
    ports:
      - "3010:3010"
    volumes:
      - "$HOME/.config/workflows:/workflows"
    environment:
      MCP_TRANSPORT_TYPE: http
      MCP_HTTP_PORT: 3010
      MCP_LOG_LEVEL: info
    labels:
      traefik.enable: true
      traefik.http.services.workflows.loadbalancer.server.port: 3010
      traefik.http.routers.workflows.rule: Host(`mcp.localhost`) && PathPrefix(`/workflows`)
      traefik.http.routers.workflows.service: workflows
      traefik.http.routers.workflows.entrypoints: web

  # 2. Task Manager MCP - AI-powered task planning
  task-manager-mcp:
    build:
      context: https://github.com/tradesdontlie/task-manager-mcp.git
    container_name: task-manager
    restart: unless-stopped
    ports:
      - "8050:8050"
    volumes:
      - "$HOME/.local/share/mcp/tasks:/app/tasks"
    environment:
      TRANSPORT: sse
      HOST: 0.0.0.0
      PORT: 8050
      LLM_PROVIDER: openai
      LLM_API_KEY: "your-api-key-or-ollama-dummy"
      LLM_CHOICE: "gpt-4"
      OPENAI_API_BASE: "http://ollama:11434/v1" # For local Ollama
    labels:
      traefik.enable: true
      traefik.http.services.taskmanager.loadbalancer.server.port: 8050
      traefik.http.routers.taskmanager.rule: Host(`mcp.localhost`) && PathPrefix(`/tasks`)
      traefik.http.routers.taskmanager.service: taskmanager
      traefik.http.routers.taskmanager.entrypoints: web
    depends_on:
      - ollama-cpu

  # 3. Todoist MCP - Todoist integration
  todoist-mcp:
    image: python:3.12-alpine
    container_name: todoist
    restart: unless-stopped
    working_dir: /app
    command:
      - sh
      - -c
      - |
        pip install todoist-mcp-server &&
        exec python -m todoist_mcp_server
    environment:
      TODOIST_API_TOKEN: "your-todoist-api-token"
      TRANSPORT: stdio
